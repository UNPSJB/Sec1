{% extends 'list.html' %} 

{% block ttitle %} Listado de Encargados {% endblock %}

{% block thead %}
<div id="messageArea"></div>

<tr>
    <th scope="col">DNI</th>
    <th scope="col">Nombre</th>
    <th scope="col">Apellido</th>
    <th scope="col">Telefono</th>
    <th scope="col">Domicilio</th>
    <th scope="col"> Acciones</th>
</tr>
{% endblock %}

{% block tbody %}
{% for persona in object_list %}
<tr>
    <td>{{ persona.dni }}</td>
    <td>{{ persona.nombre }}</td>
    <td>{{ persona.apellido }}</td>
    <td>{{ persona.telefono }}</td>
    <td>{{ persona.domicilio }}</td>
    <td>
        <a href="{% url 'modificarEncargado' persona.pk %}"class="btn btn-success">Editar</a>
        <button class="btn btn-danger eliminarEncargado" data-id="{{ persona.pk }}" data-nombre="{{ persona.nombre }}" data-bs-toggle="modal" data-bs-target="#eliminarEncargado">
         Eliminar
        </button>
    
    </td>
</tr>




{% endfor %}
{% endblock %}


{% block modal %}

<!-- Modal de eliminacion del encargado -->
<div class="modal fade" id="eliminarEncargado" tabindex="-1" aria-labelledby="eliminarEncargadoLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eliminarEncargadoLabel">Confirmar deshabilitación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                ¿Estás seguro de eliminar el encargado: <strong id="encargadoNombre"></strong>?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-danger" id="confirmarEliminacionEncargado">Eliminar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extracss %}
    <style>
        #messageArea .alert {
            opacity: 1;
            visibility: visible;
            transition: all 0.3s ease-in-out;
            margin-bottom: 1rem;
        }

        #messageArea .alert.fade-out {
            opacity: 0;
            visibility: hidden;
            margin-top: -58px; /* Ajusta este valor según la altura de tu alerta */
        }
    </style>
{% endblock %}

{% block extrajs %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('eliminarEncargado');
        modal.addEventListener('show.bs.modal', function(event) {
            const button = event.relatedTarget;
            const nombre = button.getAttribute('data-nombre');
            const id = button.getAttribute('data-id');
            const modalBody = modal.querySelector('#encargadoNombre');
            modalBody.textContent = nombre;

            const confirmarButton = modal.querySelector('#confirmarEliminacionEncargado');
            confirmarButton.setAttribute('data-id', id);
            
            document.getElementById('messageArea').innerHTML = '';
        });

        const confirmarButton = document.getElementById('confirmarEliminacionEncargado');
        confirmarButton.addEventListener('click', function() {
            const id = this.getAttribute('data-id');

            fetch(`/salones/eliminarEncargado/${id}`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: id })
            })
            .then(response => response.json())
            .then(data => {
                $('#eliminarEncargado').modal('hide');

                const messageArea = document.getElementById('messageArea');
                const alertClass = data.status === 'success' ? 'alert-success' : 'alert-danger';
                const message = data.status === 'success' 
                    ? 'Encargado eliminado exitosamente.'
                    : data.message || 'Error al eliminar el encargado.';

                messageArea.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;

                if (data.status === 'success') {
                    setTimeout(() => {
                        const alert = messageArea.querySelector('.alert');
                        if (alert) {
                            alert.classList.add('fade-out');
                            setTimeout(() => {
                                location.reload();
                            }, 300); // Reducido de 500ms a 300ms
                        }
                    }, 1000); // Reducido de 2000ms a 1000ms
                } else {
                    setTimeout(() => {
                        const alert = messageArea.querySelector('.alert');
                        if (alert) {
                            alert.classList.add('fade-out');
                            setTimeout(() => {
                                messageArea.innerHTML = '';
                            }, 300); // Reducido de 500ms a 300ms
                        }
                    }, 1500); // Reducido de 3000ms a 1500ms
                }
            })
            .catch(error => {
                console.error('Error:', error);
                const messageArea = document.getElementById('messageArea');
                messageArea.innerHTML = `<div class="alert alert-danger">Error al eliminar el encargado.</div>`;
                
                setTimeout(() => {
                    const alert = messageArea.querySelector('.alert');
                    if (alert) {
                        alert.classList.add('fade-out');
                        setTimeout(() => {
                            messageArea.innerHTML = '';
                        }, 300); // Reducido de 500ms a 300ms
                    }
                }, 1500); // Reducido de 3000ms a 1500ms
            });
        });
    });
</script>

{% endblock %}